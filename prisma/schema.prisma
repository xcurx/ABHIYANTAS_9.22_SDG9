generator client {
    provider = "prisma-client"
    output   = "../generated/prisma"
}

datasource db {
    provider = "postgresql"
}

// ==================== USER & AUTH ====================

model User {
    id            String    @id @default(cuid())
    email         String    @unique
    emailVerified DateTime?
    name          String?
    password      String?
    avatar        String?
    role          UserRole  @default(PARTICIPANT)
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt

    // Relations
    accounts              Account[]
    sessions              Session[]
    organizationMemberships OrganizationMember[]
}

model Account {
    id                String  @id @default(cuid())
    userId            String
    type              String
    provider          String
    providerAccountId String
    refresh_token     String?
    access_token      String?
    expires_at        Int?
    token_type        String?
    scope             String?
    id_token          String?
    session_state     String?

    user User @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@unique([provider, providerAccountId])
}

model Session {
    id           String   @id @default(cuid())
    sessionToken String   @unique
    userId       String
    expires      DateTime
    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
    identifier String
    token      String   @unique
    expires    DateTime

    @@unique([identifier, token])
}

enum UserRole {
    SUPER_ADMIN
    ORGANIZATION_ADMIN
    MENTOR
    JUDGE
    PARTICIPANT
    SPONSOR
}

// ==================== ORGANIZATION ====================

model Organization {
    id          String           @id @default(cuid())
    name        String
    slug        String           @unique
    type        OrganizationType
    description String?
    logo        String?
    website     String?
    industry    String?
    size        String?          // e.g., "1-10", "11-50", "51-200", "201-500", "500+"
    location    String?
    isVerified  Boolean          @default(false)
    createdAt   DateTime         @default(now())
    updatedAt   DateTime         @updatedAt

    // Relations
    members OrganizationMember[]
}

model OrganizationMember {
    id             String        @id @default(cuid())
    userId         String
    organizationId String
    role           OrgMemberRole @default(MEMBER)
    joinedAt       DateTime      @default(now())

    user         User         @relation(fields: [userId], references: [id], onDelete: Cascade)
    organization Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

    @@unique([userId, organizationId])
}

enum OrganizationType {
    COMPANY
    UNIVERSITY
    NONPROFIT
    GOVERNMENT
    OTHER
}

enum OrgMemberRole {
    OWNER
    ADMIN
    MEMBER
}
